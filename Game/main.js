import {
  Camera,
  Color,
  Component,
  Convex,
  Keyboard,
  Mouse,
  RenderComponent,
  RigidbodyComponent,
  Runtime_default,
  ShapeRendererComponent,
  TileMap,
  TileRendererComponent,
  Vector2,
  __name,
  lerp
} from "../chunk-UVEQVABF.js";

// src/Game/Components/CameraFollowComponent.ts
var CameraFollowComponent = class extends Component {
  defaults = {
    followSpeed: 0.8,
    threshold: 100
  };
  update({ followSpeed, threshold }, entity) {
    const speed = Camera.position.distance(entity.transform.position) / (threshold / Camera.zoom) * followSpeed;
    Camera.position = Camera.position.lerp(entity.transform.position, speed);
    if (Runtime_default.debug) {
      Runtime_default.canvas.vector(Camera.cameraToWorldSpace(new Vector2(50, 50).minus(Runtime_default.canvas.middle)), 0, Vector2.up.multiply(40).divide(Camera.zoom), Color.red);
    }
  }
};
__name(CameraFollowComponent, "CameraFollowComponent");

// src/Game/Components/FollowPlayerComponent.ts
var FollowPlayerComponent = class extends Component {
  dependencies = [RigidbodyComponent];
  defaults = {
    speed: 1,
    distance: 16
  };
  update(attributes, entity) {
    const player = Runtime_default.getEntity("player");
    const rigidbody = entity.getComponent(RigidbodyComponent);
    if (!player)
      throw new Error("No player entity found.");
    const distance = entity.transform.position.distance(player.transform.position);
    if (distance > attributes.distance)
      rigidbody.velocity = entity.transform.position.minus(player.transform.position).normalize().invert().multiply(attributes.speed).limit(attributes.distance);
  }
};
__name(FollowPlayerComponent, "FollowPlayerComponent");

// src/Game/Components/KeyboardControllerComponent.ts
var KeyboardControllerComponent = class extends Component {
  dependencies = [RigidbodyComponent];
  defaults = {
    speed: 1,
    sprintSpeed: 5,
    velocity: new Vector2()
  };
  update(attributes, entity) {
    const rigidbody = entity.getComponent(RigidbodyComponent);
    let { speed, sprintSpeed } = attributes;
    if (Keyboard.isDown("shift"))
      speed = sprintSpeed;
    let direction = Vector2.zero;
    if (Keyboard.isDown("s")) {
      direction = direction.add(Vector2.down);
    }
    if (Keyboard.isDown("w")) {
      direction = direction.add(Vector2.up);
    }
    if (Keyboard.isDown("a")) {
      direction = direction.add(Vector2.left);
    }
    if (Keyboard.isDown("d")) {
      direction = direction.add(Vector2.right);
    }
    direction = direction.rotate(-Camera.rotation);
    rigidbody.velocity = rigidbody.velocity.add(direction);
  }
};
__name(KeyboardControllerComponent, "KeyboardControllerComponent");

// src/Game/Components/MouseControllerComponent.ts
var MouseControllerComponent = class extends Component {
  dependencies = [RigidbodyComponent];
  defaults = {
    speed: 1
  };
  update(attributes, entity) {
    const { speed } = attributes;
    const rigidbody = entity.getComponent(RigidbodyComponent);
    attributes.speed = Mouse.right ? 7.5 : 2.5;
    if (Mouse.middle)
      attributes.speed = Mouse.position.minus(entity.transform.position).length;
    rigidbody.velocity = Mouse.position.minus(entity.transform.position).normalize().multiply(speed);
  }
};
__name(MouseControllerComponent, "MouseControllerComponent");

// src/Game/Components/RotateComponent.ts
var RotateComponent = class extends RenderComponent {
  defaults = {
    rotationSpeed: 1
  };
  render(attributes, entity) {
    entity.transform.rotation += attributes.rotationSpeed;
  }
};
__name(RotateComponent, "RotateComponent");

// src/Game/Components/ZoomComponent.ts
var ZoomComponent = class extends Component {
  defaults = {
    cameraRotation: 0,
    zoom: 1,
    zoomSpeed: 0.05
  };
  update(attributes) {
    if (Keyboard.isPressed("arrowright"))
      attributes.cameraRotation += 45;
    if (Keyboard.isPressed("arrowleft"))
      attributes.cameraRotation -= 45;
    attributes.zoom = lerp(attributes.zoom, Math.max(1, Math.min(Mouse.wheel, 16)), 0.8);
    Camera.rotation = lerp(Camera.rotation, attributes.cameraRotation, 0.02);
    Camera.zoom = lerp(Camera.zoom, attributes.zoom, attributes.zoomSpeed);
  }
};
__name(ZoomComponent, "ZoomComponent");

// src/Game/main.ts
Runtime_default.registerComponent(MouseControllerComponent, KeyboardControllerComponent, FollowPlayerComponent, ZoomComponent, RotateComponent, CameraFollowComponent);
var shapes = [
  {
    offset: new Vector2(16, 16),
    rotation: 0,
    color: Color.red,
    type: "box",
    size: 32
  },
  {
    offset: new Vector2(-16, -16),
    rotation: 45,
    color: Color.red,
    type: "box",
    size: 32
  },
  {
    offset: new Vector2(16, -16),
    rotation: 0,
    color: Color.red,
    type: "circle",
    size: 32
  },
  {
    offset: new Vector2(-16, 16),
    rotation: 225,
    color: Color.red,
    type: "circle",
    size: 32,
    arc: [0, 180]
  }
];
var points = Convex.convertShapesToPoints(shapes);
async function start() {
  Runtime_default.canvas.background = Color.black;
  Camera.zoom = 4;
  const tileMap = await TileMap.load("assets/tilemap.png", { tileWidth: 16, tileHeight: 16 });
  const player = Runtime_default.createEntity("player");
  player.addComponent(TileRendererComponent, {
    tileMap,
    tile: [13, 14, 15]
  });
  player.addComponent([CameraFollowComponent, KeyboardControllerComponent, ZoomComponent]);
  const enemy = Runtime_default.createEntity("enemy");
  enemy.transform.position = Vector2.random.multiply(100);
  enemy.addComponent(ShapeRendererComponent, {
    shapes
  });
  Runtime_default.onUpdate(() => {
    Runtime_default.canvas.wirePolygon(enemy.transform.position.add(100, 0), 0, Color.green, points);
  });
  const circle = Runtime_default.createEntity("circle");
  circle.transform.position = Vector2.zero;
  circle.addComponent(ShapeRendererComponent, {
    shapes: [
      {
        type: "circle",
        size: 32,
        color: Color.blue,
        offset: new Vector2(0, 0),
        rotation: 180,
        arc: [0, 180]
      }
    ]
  });
  circle.addComponent(RotateComponent);
}
__name(start, "start");
start();
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vc3JjL0dhbWUvQ29tcG9uZW50cy9DYW1lcmFGb2xsb3dDb21wb25lbnQudHMiLCAiLi4vLi4vc3JjL0dhbWUvQ29tcG9uZW50cy9Gb2xsb3dQbGF5ZXJDb21wb25lbnQudHMiLCAiLi4vLi4vc3JjL0dhbWUvQ29tcG9uZW50cy9LZXlib2FyZENvbnRyb2xsZXJDb21wb25lbnQudHMiLCAiLi4vLi4vc3JjL0dhbWUvQ29tcG9uZW50cy9Nb3VzZUNvbnRyb2xsZXJDb21wb25lbnQudHMiLCAiLi4vLi4vc3JjL0dhbWUvQ29tcG9uZW50cy9Sb3RhdGVDb21wb25lbnQudHMiLCAiLi4vLi4vc3JjL0dhbWUvQ29tcG9uZW50cy9ab29tQ29tcG9uZW50LnRzIiwgIi4uLy4uL3NyYy9HYW1lL21haW4udHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCBDYW1lcmEgZnJvbSAnQC9SZW5kZXJlci9DYW1lcmEnO1xuaW1wb3J0IEdhbWUsIHsgQ29sb3IsIENvbXBvbmVudCwgRW50aXR5LCBWZWN0b3IyIH0gZnJvbSAnRW5naW5lJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FtZXJhRm9sbG93Q29tcG9uZW50IGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICBvdmVycmlkZSBkZWZhdWx0cyA9IHtcbiAgICAgICAgZm9sbG93U3BlZWQ6IDAuOCxcbiAgICAgICAgdGhyZXNob2xkOiAxMDBcbiAgICB9O1xuXG5cbiAgICBvdmVycmlkZSB1cGRhdGUoeyBmb2xsb3dTcGVlZCwgdGhyZXNob2xkIH06IHRoaXNbJ2RlZmF1bHRzJ10sIGVudGl0eTogRW50aXR5KTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHNwZWVkID0gQ2FtZXJhLnBvc2l0aW9uLmRpc3RhbmNlKGVudGl0eS50cmFuc2Zvcm0ucG9zaXRpb24pIC8gKHRocmVzaG9sZCAvIENhbWVyYS56b29tKSAqIGZvbGxvd1NwZWVkO1xuXG4gICAgICAgIENhbWVyYS5wb3NpdGlvbiA9IENhbWVyYS5wb3NpdGlvbi5sZXJwKGVudGl0eS50cmFuc2Zvcm0ucG9zaXRpb24sIHNwZWVkKTtcblxuICAgICAgICBpZiAoR2FtZS5kZWJ1Zykge1xuICAgICAgICAgICAgR2FtZS5jYW52YXMudmVjdG9yKFxuICAgICAgICAgICAgICAgIENhbWVyYS5jYW1lcmFUb1dvcmxkU3BhY2UoXG4gICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IyKDUwLCA1MCkubWludXMoR2FtZS5jYW52YXMubWlkZGxlKVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICAgICBWZWN0b3IyLnVwLm11bHRpcGx5KDQwKS5kaXZpZGUoQ2FtZXJhLnpvb20pLFxuICAgICAgICAgICAgICAgIENvbG9yLnJlZFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiIsICJpbXBvcnQgUmlnaWRib2R5Q29tcG9uZW50IGZyb20gJ0AvQ29tcG9uZW50cy9SaWdpZGJvZHlDb21wb25lbnQnO1xuaW1wb3J0IEdhbWUsIHsgQ29tcG9uZW50LCBFbnRpdHksIFZlY3RvcjIgfSBmcm9tICdFbmdpbmUnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGb2xsb3dQbGF5ZXJDb21wb25lbnQgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIG92ZXJyaWRlIHJlYWRvbmx5IGRlcGVuZGVuY2llcyA9IFtSaWdpZGJvZHlDb21wb25lbnRdO1xuXG4gICAgb3ZlcnJpZGUgZGVmYXVsdHMgPSB7XG4gICAgICAgIHNwZWVkOiAxLFxuICAgICAgICBkaXN0YW5jZTogMTZcbiAgICB9O1xuXG4gICAgb3ZlcnJpZGUgdXBkYXRlKGF0dHJpYnV0ZXM6IHRoaXNbJ2RlZmF1bHRzJ10sIGVudGl0eTogRW50aXR5KTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHBsYXllciA9IEdhbWUuZ2V0RW50aXR5KFwicGxheWVyXCIpO1xuICAgICAgICBjb25zdCByaWdpZGJvZHkgPSBlbnRpdHkuZ2V0Q29tcG9uZW50KFJpZ2lkYm9keUNvbXBvbmVudCk7XG5cbiAgICAgICAgaWYgKCFwbGF5ZXIpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBwbGF5ZXIgZW50aXR5IGZvdW5kLlwiKTtcblxuICAgICAgICBjb25zdCBkaXN0YW5jZSA9IGVudGl0eS50cmFuc2Zvcm0ucG9zaXRpb24uZGlzdGFuY2UocGxheWVyLnRyYW5zZm9ybS5wb3NpdGlvbik7XG5cbiAgICAgICAgaWYgKGRpc3RhbmNlID4gYXR0cmlidXRlcy5kaXN0YW5jZSlcbiAgICAgICAgICAgIHJpZ2lkYm9keS52ZWxvY2l0eSA9IGVudGl0eS50cmFuc2Zvcm0ucG9zaXRpb24ubWludXMocGxheWVyLnRyYW5zZm9ybS5wb3NpdGlvbikubm9ybWFsaXplKCkuaW52ZXJ0KCkubXVsdGlwbHkoYXR0cmlidXRlcy5zcGVlZCkubGltaXQoYXR0cmlidXRlcy5kaXN0YW5jZSk7XG4gICAgfVxufSIsICJpbXBvcnQgeyBDYW1lcmEgfSBmcm9tICdAL1JlbmRlcmVyJztcbmltcG9ydCBSaWdpZGJvZHlDb21wb25lbnQgZnJvbSAnQC9Db21wb25lbnRzL1JpZ2lkYm9keUNvbXBvbmVudCc7XG5pbXBvcnQgR2FtZSwgeyBDb21wb25lbnQsIEVudGl0eSwgS2V5Ym9hcmQsIFZlY3RvcjIgfSBmcm9tICdFbmdpbmUnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBLZXlib2FyZENvbnRyb2xsZXJDb21wb25lbnQgZXh0ZW5kcyBDb21wb25lbnQge1xuXG4gICAgb3ZlcnJpZGUgcmVhZG9ubHkgZGVwZW5kZW5jaWVzID0gW1JpZ2lkYm9keUNvbXBvbmVudF07XG5cbiAgICBvdmVycmlkZSBkZWZhdWx0cyA9IHtcbiAgICAgICAgc3BlZWQ6IDEsXG4gICAgICAgIHNwcmludFNwZWVkOiA1LFxuICAgICAgICB2ZWxvY2l0eTogbmV3IFZlY3RvcjIoKVxuICAgIH07XG5cbiAgICBvdmVycmlkZSB1cGRhdGUoYXR0cmlidXRlczogdGhpc1snZGVmYXVsdHMnXSwgZW50aXR5OiBFbnRpdHkpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcmlnaWRib2R5ID0gZW50aXR5LmdldENvbXBvbmVudChSaWdpZGJvZHlDb21wb25lbnQpO1xuICAgICAgICBsZXQgeyBzcGVlZCwgc3ByaW50U3BlZWQgfSA9IGF0dHJpYnV0ZXM7XG5cbiAgICAgICAgaWYgKEtleWJvYXJkLmlzRG93bihcInNoaWZ0XCIpKVxuICAgICAgICAgICAgc3BlZWQgPSBzcHJpbnRTcGVlZDtcblxuICAgICAgICBsZXQgZGlyZWN0aW9uID0gVmVjdG9yMi56ZXJvO1xuICAgICAgICBpZiAoS2V5Ym9hcmQuaXNEb3duKFwic1wiKSkge1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gZGlyZWN0aW9uLmFkZChWZWN0b3IyLmRvd24pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKEtleWJvYXJkLmlzRG93bihcIndcIikpIHtcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IGRpcmVjdGlvbi5hZGQoVmVjdG9yMi51cCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoS2V5Ym9hcmQuaXNEb3duKFwiYVwiKSkge1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gZGlyZWN0aW9uLmFkZChWZWN0b3IyLmxlZnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKEtleWJvYXJkLmlzRG93bihcImRcIikpIHtcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IGRpcmVjdGlvbi5hZGQoVmVjdG9yMi5yaWdodCk7XG4gICAgICAgIH1cblxuICAgICAgICBkaXJlY3Rpb24gPSBkaXJlY3Rpb24ucm90YXRlKC1DYW1lcmEucm90YXRpb24pO1xuXG4gICAgICAgIHJpZ2lkYm9keS52ZWxvY2l0eSA9IHJpZ2lkYm9keS52ZWxvY2l0eS5hZGQoZGlyZWN0aW9uKTtcbiAgICB9XG5cbn0iLCAiaW1wb3J0IFJpZ2lkYm9keUNvbXBvbmVudCBmcm9tICdAL0NvbXBvbmVudHMvUmlnaWRib2R5Q29tcG9uZW50JztcbmltcG9ydCB7IENvbXBvbmVudCwgRW50aXR5LCBNb3VzZSwgVmVjdG9yMiB9IGZyb20gJ0VuZ2luZSc7XG5cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW91c2VDb250cm9sbGVyQ29tcG9uZW50IGV4dGVuZHMgQ29tcG9uZW50IHtcblxuICAgIG92ZXJyaWRlIHJlYWRvbmx5IGRlcGVuZGVuY2llcyA9IFtSaWdpZGJvZHlDb21wb25lbnRdO1xuXG4gICAgb3ZlcnJpZGUgZGVmYXVsdHMgPSB7XG4gICAgICAgIHNwZWVkOiAxLFxuICAgIH07XG5cbiAgICBvdmVycmlkZSB1cGRhdGUoYXR0cmlidXRlczogdGhpc1snZGVmYXVsdHMnXSwgZW50aXR5OiBFbnRpdHkpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyBzcGVlZCB9ID0gYXR0cmlidXRlcztcbiAgICAgICAgY29uc3QgcmlnaWRib2R5ID0gZW50aXR5LmdldENvbXBvbmVudChSaWdpZGJvZHlDb21wb25lbnQpXG5cbiAgICAgICAgYXR0cmlidXRlcy5zcGVlZCA9IE1vdXNlLnJpZ2h0ID8gNy41IDogMi41O1xuICAgICAgICBpZiAoTW91c2UubWlkZGxlKVxuICAgICAgICAgICAgYXR0cmlidXRlcy5zcGVlZCA9IE1vdXNlLnBvc2l0aW9uLm1pbnVzKGVudGl0eS50cmFuc2Zvcm0ucG9zaXRpb24pLmxlbmd0aDtcblxuICAgICAgICByaWdpZGJvZHkudmVsb2NpdHkgPSBNb3VzZS5wb3NpdGlvbi5taW51cyhlbnRpdHkudHJhbnNmb3JtLnBvc2l0aW9uKS5ub3JtYWxpemUoKS5tdWx0aXBseShzcGVlZCk7XG4gICAgfVxuXG59IiwgImltcG9ydCBSZW5kZXJDb21wb25lbnQgZnJvbSAnQC9Db21wb25lbnRzL1JlbmRlckNvbXBvbmVudCc7XG5pbXBvcnQgeyBFbnRpdHkgfSBmcm9tICdFbmdpbmUnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSb3RhdGVDb21wb25lbnQgZXh0ZW5kcyBSZW5kZXJDb21wb25lbnQge1xuXG4gICAgb3ZlcnJpZGUgZGVmYXVsdHMgPSB7XG4gICAgICAgIHJvdGF0aW9uU3BlZWQ6IDFcbiAgICB9O1xuXG4gICAgb3ZlcnJpZGUgcmVuZGVyKGF0dHJpYnV0ZXM6IHRoaXNbXCJkZWZhdWx0c1wiXSwgZW50aXR5OiBFbnRpdHkpIHtcbiAgICAgICAgZW50aXR5LnRyYW5zZm9ybS5yb3RhdGlvbiArPSBhdHRyaWJ1dGVzLnJvdGF0aW9uU3BlZWQ7XG4gICAgfVxuXG59IiwgImltcG9ydCB7IENhbWVyYSB9IGZyb20gJ0AvUmVuZGVyZXInO1xuaW1wb3J0IHsgbGVycCB9IGZyb20gJ0AvSGVscGVycyc7XG5pbXBvcnQgR2FtZSwgeyBDb2xvciwgQ29tcG9uZW50LCBLZXlib2FyZCwgTW91c2UsIFZlY3RvcjIgfSBmcm9tICdFbmdpbmUnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBab29tQ29tcG9uZW50IGV4dGVuZHMgQ29tcG9uZW50IHtcblxuICAgIG92ZXJyaWRlIGRlZmF1bHRzID0ge1xuICAgICAgICBjYW1lcmFSb3RhdGlvbjogMCxcbiAgICAgICAgem9vbTogMSxcbiAgICAgICAgem9vbVNwZWVkOiAwLjA1XG4gICAgfTtcblxuICAgIG92ZXJyaWRlIHVwZGF0ZShhdHRyaWJ1dGVzOiB0aGlzW1wiZGVmYXVsdHNcIl0pIHtcbiAgICAgICAgaWYgKEtleWJvYXJkLmlzUHJlc3NlZChcImFycm93cmlnaHRcIikpXG4gICAgICAgICAgICBhdHRyaWJ1dGVzLmNhbWVyYVJvdGF0aW9uICs9IDQ1O1xuXG4gICAgICAgIGlmIChLZXlib2FyZC5pc1ByZXNzZWQoXCJhcnJvd2xlZnRcIikpXG4gICAgICAgICAgICBhdHRyaWJ1dGVzLmNhbWVyYVJvdGF0aW9uIC09IDQ1O1xuXG4gICAgICAgIGF0dHJpYnV0ZXMuem9vbSA9IGxlcnAoYXR0cmlidXRlcy56b29tLCBNYXRoLm1heCgxLCBNYXRoLm1pbihNb3VzZS53aGVlbCwgMTYpKSwgMC44KTtcblxuICAgICAgICBDYW1lcmEucm90YXRpb24gPSBsZXJwKENhbWVyYS5yb3RhdGlvbiwgYXR0cmlidXRlcy5jYW1lcmFSb3RhdGlvbiwgMC4wMik7XG4gICAgICAgIENhbWVyYS56b29tID0gbGVycChDYW1lcmEuem9vbSwgYXR0cmlidXRlcy56b29tLCBhdHRyaWJ1dGVzLnpvb21TcGVlZCk7XG4gICAgfVxuXG59IiwgImltcG9ydCB7IENhbWVyYSB9IGZyb20gJ0AvUmVuZGVyZXInO1xuaW1wb3J0IFNoYXBlUmVuZGVyZXJDb21wb25lbnQgZnJvbSAnQC9Db21wb25lbnRzL1NoYXBlUmVuZGVyZXJDb21wb25lbnQnO1xuaW1wb3J0IFRpbGVSZW5kZXJlckNvbXBvbmVudCBmcm9tICdAL0NvbXBvbmVudHMvVGlsZVJlbmRlcmVyQ29tcG9uZW50JztcbmltcG9ydCB0eXBlIHsgU2hhcGUgfSBmcm9tICdAL1JlbmRlcmVyJztcbmltcG9ydCBHYW1lLCB7IENvbG9yLCBFbnRpdHksIE1vdXNlLCBUaWxlbWFwLCBWZWN0b3IyIH0gZnJvbSAnRW5naW5lJztcbmltcG9ydCBDYW1lcmFGb2xsb3dDb21wb25lbnQgZnJvbSAnLi9Db21wb25lbnRzL0NhbWVyYUZvbGxvd0NvbXBvbmVudCc7XG5pbXBvcnQgRm9sbG93UGxheWVyQ29tcG9uZW50IGZyb20gJy4vQ29tcG9uZW50cy9Gb2xsb3dQbGF5ZXJDb21wb25lbnQnO1xuaW1wb3J0IEtleWJvYXJkQ29udHJvbGxlckNvbXBvbmVudCBmcm9tICcuL0NvbXBvbmVudHMvS2V5Ym9hcmRDb250cm9sbGVyQ29tcG9uZW50JztcbmltcG9ydCBNb3VzZUNvbnRyb2xsZXJDb21wb25lbnQgZnJvbSAnLi9Db21wb25lbnRzL01vdXNlQ29udHJvbGxlckNvbXBvbmVudCc7XG5pbXBvcnQgUm90YXRlQ29tcG9uZW50IGZyb20gJy4vQ29tcG9uZW50cy9Sb3RhdGVDb21wb25lbnQnO1xuaW1wb3J0IFpvb21Db21wb25lbnQgZnJvbSAnLi9Db21wb25lbnRzL1pvb21Db21wb25lbnQnO1xuaW1wb3J0IENvbnZleCBmcm9tICdAL1JlbmRlcmVyL0NvbnZleCc7XG5cbkdhbWUucmVnaXN0ZXJDb21wb25lbnQoXG4gICAgTW91c2VDb250cm9sbGVyQ29tcG9uZW50LFxuICAgIEtleWJvYXJkQ29udHJvbGxlckNvbXBvbmVudCxcbiAgICBGb2xsb3dQbGF5ZXJDb21wb25lbnQsXG4gICAgWm9vbUNvbXBvbmVudCxcbiAgICBSb3RhdGVDb21wb25lbnQsXG4gICAgQ2FtZXJhRm9sbG93Q29tcG9uZW50XG4pO1xuY29uc3Qgc2hhcGVzOiBTaGFwZVtdID0gW1xuICAgIHtcbiAgICAgICAgb2Zmc2V0OiBuZXcgVmVjdG9yMigxNiwgMTYpLFxuICAgICAgICByb3RhdGlvbjogMCxcbiAgICAgICAgY29sb3I6IENvbG9yLnJlZCxcbiAgICAgICAgdHlwZTogXCJib3hcIixcbiAgICAgICAgc2l6ZTogMzJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgb2Zmc2V0OiBuZXcgVmVjdG9yMigtMTYsIC0xNiksXG4gICAgICAgIHJvdGF0aW9uOiA0NSxcbiAgICAgICAgY29sb3I6IENvbG9yLnJlZCxcbiAgICAgICAgdHlwZTogXCJib3hcIixcbiAgICAgICAgc2l6ZTogMzJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgb2Zmc2V0OiBuZXcgVmVjdG9yMigxNiwgLTE2KSxcbiAgICAgICAgcm90YXRpb246IDAsXG4gICAgICAgIGNvbG9yOiBDb2xvci5yZWQsXG4gICAgICAgIHR5cGU6IFwiY2lyY2xlXCIsXG4gICAgICAgIHNpemU6IDMyXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG9mZnNldDogbmV3IFZlY3RvcjIoLTE2LCAxNiksXG4gICAgICAgIHJvdGF0aW9uOiAyMjUsXG4gICAgICAgIGNvbG9yOiBDb2xvci5yZWQsXG4gICAgICAgIHR5cGU6IFwiY2lyY2xlXCIsXG4gICAgICAgIHNpemU6IDMyLFxuICAgICAgICBhcmM6IFswLCAxODBdXG4gICAgfVxuXTtcblxuY29uc3QgcG9pbnRzID0gQ29udmV4LmNvbnZlcnRTaGFwZXNUb1BvaW50cyhzaGFwZXMpO1xuXG5hc3luYyBmdW5jdGlvbiBzdGFydCgpIHtcbiAgICBHYW1lLmNhbnZhcy5iYWNrZ3JvdW5kID0gQ29sb3IuYmxhY2s7XG4gICAgQ2FtZXJhLnpvb20gPSA0O1xuXG5cbiAgICBjb25zdCB0aWxlTWFwID0gYXdhaXQgVGlsZW1hcC5sb2FkKFwiYXNzZXRzL3RpbGVtYXAucG5nXCIsIHsgdGlsZVdpZHRoOiAxNiwgdGlsZUhlaWdodDogMTYgfSk7XG5cbiAgICBjb25zdCBwbGF5ZXIgPSBHYW1lLmNyZWF0ZUVudGl0eShcInBsYXllclwiKTtcblxuICAgIHBsYXllci5hZGRDb21wb25lbnQoVGlsZVJlbmRlcmVyQ29tcG9uZW50LCB7XG4gICAgICAgIHRpbGVNYXAsXG4gICAgICAgIHRpbGU6IFsxMywgMTQsIDE1XVxuICAgIH0pO1xuICAgIHBsYXllci5hZGRDb21wb25lbnQoW0NhbWVyYUZvbGxvd0NvbXBvbmVudCwgS2V5Ym9hcmRDb250cm9sbGVyQ29tcG9uZW50LCBab29tQ29tcG9uZW50XSk7XG5cblxuICAgIGNvbnN0IGVuZW15ID0gR2FtZS5jcmVhdGVFbnRpdHkoXCJlbmVteVwiKTtcbiAgICBlbmVteS50cmFuc2Zvcm0ucG9zaXRpb24gPSBWZWN0b3IyLnJhbmRvbS5tdWx0aXBseSgxMDApO1xuICAgIGVuZW15LmFkZENvbXBvbmVudChTaGFwZVJlbmRlcmVyQ29tcG9uZW50LCB7XG4gICAgICAgIHNoYXBlc1xuICAgIH0pO1xuXG4gICAgR2FtZS5vblVwZGF0ZSgoKSA9PiB7XG4gICAgICAgIEdhbWUuY2FudmFzLndpcmVQb2x5Z29uKGVuZW15LnRyYW5zZm9ybS5wb3NpdGlvbi5hZGQoMTAwLCAwKSwgMCwgQ29sb3IuZ3JlZW4sIHBvaW50cyk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBjaXJjbGUgPSBHYW1lLmNyZWF0ZUVudGl0eShcImNpcmNsZVwiKTtcbiAgICBjaXJjbGUudHJhbnNmb3JtLnBvc2l0aW9uID0gVmVjdG9yMi56ZXJvO1xuICAgIGNpcmNsZS5hZGRDb21wb25lbnQoU2hhcGVSZW5kZXJlckNvbXBvbmVudCwge1xuICAgICAgICBzaGFwZXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcImNpcmNsZVwiLFxuICAgICAgICAgICAgICAgIHNpemU6IDMyLFxuICAgICAgICAgICAgICAgIGNvbG9yOiBDb2xvci5ibHVlLFxuICAgICAgICAgICAgICAgIG9mZnNldDogbmV3IFZlY3RvcjIoMCwgMCksXG4gICAgICAgICAgICAgICAgcm90YXRpb246IDE4MCxcbiAgICAgICAgICAgICAgICBhcmM6IFswLCAxODBdXG4gICAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICB9KTtcbiAgICBjaXJjbGUuYWRkQ29tcG9uZW50KFJvdGF0ZUNvbXBvbmVudCk7XG59XG5cbnN0YXJ0KCk7XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBR0EsMENBQW1ELFVBQVU7QUFBQSxFQUNoRCxXQUFXO0FBQUEsSUFDaEIsYUFBYTtBQUFBLElBQ2IsV0FBVztBQUFBO0FBQUEsRUFJTixPQUFPLEVBQUUsYUFBYSxhQUErQixRQUFzQjtBQUNoRixVQUFNLFFBQVEsT0FBTyxTQUFTLFNBQVMsT0FBTyxVQUFVLFlBQWEsYUFBWSxPQUFPLFFBQVE7QUFFaEcsV0FBTyxXQUFXLE9BQU8sU0FBUyxLQUFLLE9BQU8sVUFBVSxVQUFVO0FBRWxFLFFBQUksZ0JBQUssT0FBTztBQUNaLHNCQUFLLE9BQU8sT0FDUixPQUFPLG1CQUNILElBQUksUUFBUSxJQUFJLElBQUksTUFBTSxnQkFBSyxPQUFPLFVBRTFDLEdBQ0EsUUFBUSxHQUFHLFNBQVMsSUFBSSxPQUFPLE9BQU8sT0FDdEMsTUFBTTtBQUFBO0FBQUE7QUFBQTtBQW5CdEI7OztBQ0FBLDBDQUFtRCxVQUFVO0FBQUEsRUFDdkMsZUFBZSxDQUFDO0FBQUEsRUFFekIsV0FBVztBQUFBLElBQ2hCLE9BQU87QUFBQSxJQUNQLFVBQVU7QUFBQTtBQUFBLEVBR0wsT0FBTyxZQUE4QixRQUFzQjtBQUNoRSxVQUFNLFNBQVMsZ0JBQUssVUFBVTtBQUM5QixVQUFNLFlBQVksT0FBTyxhQUFhO0FBRXRDLFFBQUksQ0FBQztBQUNELFlBQU0sSUFBSSxNQUFNO0FBRXBCLFVBQU0sV0FBVyxPQUFPLFVBQVUsU0FBUyxTQUFTLE9BQU8sVUFBVTtBQUVyRSxRQUFJLFdBQVcsV0FBVztBQUN0QixnQkFBVSxXQUFXLE9BQU8sVUFBVSxTQUFTLE1BQU0sT0FBTyxVQUFVLFVBQVUsWUFBWSxTQUFTLFNBQVMsV0FBVyxPQUFPLE1BQU0sV0FBVztBQUFBO0FBQUE7QUFsQjdKOzs7QUNDQSxnREFBeUQsVUFBVTtBQUFBLEVBRTdDLGVBQWUsQ0FBQztBQUFBLEVBRXpCLFdBQVc7QUFBQSxJQUNoQixPQUFPO0FBQUEsSUFDUCxhQUFhO0FBQUEsSUFDYixVQUFVLElBQUk7QUFBQTtBQUFBLEVBR1QsT0FBTyxZQUE4QixRQUFzQjtBQUNoRSxVQUFNLFlBQVksT0FBTyxhQUFhO0FBQ3RDLFFBQUksRUFBRSxPQUFPLGdCQUFnQjtBQUU3QixRQUFJLFNBQVMsT0FBTztBQUNoQixjQUFRO0FBRVosUUFBSSxZQUFZLFFBQVE7QUFDeEIsUUFBSSxTQUFTLE9BQU8sTUFBTTtBQUN0QixrQkFBWSxVQUFVLElBQUksUUFBUTtBQUFBO0FBR3RDLFFBQUksU0FBUyxPQUFPLE1BQU07QUFDdEIsa0JBQVksVUFBVSxJQUFJLFFBQVE7QUFBQTtBQUd0QyxRQUFJLFNBQVMsT0FBTyxNQUFNO0FBQ3RCLGtCQUFZLFVBQVUsSUFBSSxRQUFRO0FBQUE7QUFHdEMsUUFBSSxTQUFTLE9BQU8sTUFBTTtBQUN0QixrQkFBWSxVQUFVLElBQUksUUFBUTtBQUFBO0FBR3RDLGdCQUFZLFVBQVUsT0FBTyxDQUFDLE9BQU87QUFFckMsY0FBVSxXQUFXLFVBQVUsU0FBUyxJQUFJO0FBQUE7QUFBQTtBQXBDcEQ7OztBQ0FBLDZDQUFzRCxVQUFVO0FBQUEsRUFFMUMsZUFBZSxDQUFDO0FBQUEsRUFFekIsV0FBVztBQUFBLElBQ2hCLE9BQU87QUFBQTtBQUFBLEVBR0YsT0FBTyxZQUE4QixRQUFzQjtBQUNoRSxVQUFNLEVBQUUsVUFBVTtBQUNsQixVQUFNLFlBQVksT0FBTyxhQUFhO0FBRXRDLGVBQVcsUUFBUSxNQUFNLFFBQVEsTUFBTTtBQUN2QyxRQUFJLE1BQU07QUFDTixpQkFBVyxRQUFRLE1BQU0sU0FBUyxNQUFNLE9BQU8sVUFBVSxVQUFVO0FBRXZFLGNBQVUsV0FBVyxNQUFNLFNBQVMsTUFBTSxPQUFPLFVBQVUsVUFBVSxZQUFZLFNBQVM7QUFBQTtBQUFBO0FBaEJsRzs7O0FDREEsb0NBQTZDLGdCQUFnQjtBQUFBLEVBRWhELFdBQVc7QUFBQSxJQUNoQixlQUFlO0FBQUE7QUFBQSxFQUdWLE9BQU8sWUFBOEIsUUFBZ0I7QUFDMUQsV0FBTyxVQUFVLFlBQVksV0FBVztBQUFBO0FBQUE7QUFQaEQ7OztBQ0NBLGtDQUEyQyxVQUFVO0FBQUEsRUFFeEMsV0FBVztBQUFBLElBQ2hCLGdCQUFnQjtBQUFBLElBQ2hCLE1BQU07QUFBQSxJQUNOLFdBQVc7QUFBQTtBQUFBLEVBR04sT0FBTyxZQUE4QjtBQUMxQyxRQUFJLFNBQVMsVUFBVTtBQUNuQixpQkFBVyxrQkFBa0I7QUFFakMsUUFBSSxTQUFTLFVBQVU7QUFDbkIsaUJBQVcsa0JBQWtCO0FBRWpDLGVBQVcsT0FBTyxLQUFLLFdBQVcsTUFBTSxLQUFLLElBQUksR0FBRyxLQUFLLElBQUksTUFBTSxPQUFPLE1BQU07QUFFaEYsV0FBTyxXQUFXLEtBQUssT0FBTyxVQUFVLFdBQVcsZ0JBQWdCO0FBQ25FLFdBQU8sT0FBTyxLQUFLLE9BQU8sTUFBTSxXQUFXLE1BQU0sV0FBVztBQUFBO0FBQUE7QUFsQnBFOzs7QUNTQSxnQkFBSyxrQkFDRCwwQkFDQSw2QkFDQSx1QkFDQSxlQUNBLGlCQUNBO0FBRUosSUFBTSxTQUFrQjtBQUFBLEVBQ3BCO0FBQUEsSUFDSSxRQUFRLElBQUksUUFBUSxJQUFJO0FBQUEsSUFDeEIsVUFBVTtBQUFBLElBQ1YsT0FBTyxNQUFNO0FBQUEsSUFDYixNQUFNO0FBQUEsSUFDTixNQUFNO0FBQUE7QUFBQSxFQUVWO0FBQUEsSUFDSSxRQUFRLElBQUksUUFBUSxLQUFLO0FBQUEsSUFDekIsVUFBVTtBQUFBLElBQ1YsT0FBTyxNQUFNO0FBQUEsSUFDYixNQUFNO0FBQUEsSUFDTixNQUFNO0FBQUE7QUFBQSxFQUVWO0FBQUEsSUFDSSxRQUFRLElBQUksUUFBUSxJQUFJO0FBQUEsSUFDeEIsVUFBVTtBQUFBLElBQ1YsT0FBTyxNQUFNO0FBQUEsSUFDYixNQUFNO0FBQUEsSUFDTixNQUFNO0FBQUE7QUFBQSxFQUVWO0FBQUEsSUFDSSxRQUFRLElBQUksUUFBUSxLQUFLO0FBQUEsSUFDekIsVUFBVTtBQUFBLElBQ1YsT0FBTyxNQUFNO0FBQUEsSUFDYixNQUFNO0FBQUEsSUFDTixNQUFNO0FBQUEsSUFDTixLQUFLLENBQUMsR0FBRztBQUFBO0FBQUE7QUFJakIsSUFBTSxTQUFTLE9BQU8sc0JBQXNCO0FBRTVDLHVCQUF1QjtBQUNuQixrQkFBSyxPQUFPLGFBQWEsTUFBTTtBQUMvQixTQUFPLE9BQU87QUFHZCxRQUFNLFVBQVUsTUFBTSxRQUFRLEtBQUssc0JBQXNCLEVBQUUsV0FBVyxJQUFJLFlBQVk7QUFFdEYsUUFBTSxTQUFTLGdCQUFLLGFBQWE7QUFFakMsU0FBTyxhQUFhLHVCQUF1QjtBQUFBLElBQ3ZDO0FBQUEsSUFDQSxNQUFNLENBQUMsSUFBSSxJQUFJO0FBQUE7QUFFbkIsU0FBTyxhQUFhLENBQUMsdUJBQXVCLDZCQUE2QjtBQUd6RSxRQUFNLFFBQVEsZ0JBQUssYUFBYTtBQUNoQyxRQUFNLFVBQVUsV0FBVyxRQUFRLE9BQU8sU0FBUztBQUNuRCxRQUFNLGFBQWEsd0JBQXdCO0FBQUEsSUFDdkM7QUFBQTtBQUdKLGtCQUFLLFNBQVMsTUFBTTtBQUNoQixvQkFBSyxPQUFPLFlBQVksTUFBTSxVQUFVLFNBQVMsSUFBSSxLQUFLLElBQUksR0FBRyxNQUFNLE9BQU87QUFBQTtBQUdsRixRQUFNLFNBQVMsZ0JBQUssYUFBYTtBQUNqQyxTQUFPLFVBQVUsV0FBVyxRQUFRO0FBQ3BDLFNBQU8sYUFBYSx3QkFBd0I7QUFBQSxJQUN4QyxRQUFRO0FBQUEsTUFDSjtBQUFBLFFBQ0ksTUFBTTtBQUFBLFFBQ04sTUFBTTtBQUFBLFFBQ04sT0FBTyxNQUFNO0FBQUEsUUFDYixRQUFRLElBQUksUUFBUSxHQUFHO0FBQUEsUUFDdkIsVUFBVTtBQUFBLFFBQ1YsS0FBSyxDQUFDLEdBQUc7QUFBQTtBQUFBO0FBQUE7QUFJckIsU0FBTyxhQUFhO0FBQUE7QUF4Q1Q7QUEyQ2Y7IiwKICAibmFtZXMiOiBbXQp9Cg==
